version: 2.1

jobs:
  build:
    parameters:
      golang_version:
        type: string

    docker:
    - image: circleci/golang:<< parameters.golang_version >>

    environment:
      GO111MODULE: "on"

    steps:
    - checkout
    - run: curl -sfL https://install.goreleaser.com/github.com/golangci/golangci-lint.sh | sh -s -- -b $(go env GOPATH)/bin v1.31.0
    - run: go mod download
    - run: golangci-lint run
    - run: go test -v ./...

workflows:
  version: 2
  main:
    jobs:
    - build:
        name: go1.14
        golang_version: "1.14"
        filters:
          tags:
            only: /.*/
    - build:
        name: go1.15
        golang_version: "1.15"
        filters:
          tags:
            only: /.*/
