version: 2.1

jobs:
  build:
    parameters:
      golang_version:
        type: string

    docker:
    - image: circleci/golang:<< parameters.golang_version >>

    environment:
      GO111MODULE: on

    steps:
    - checkout
    - run: cd .. && go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.17.1
    - run: go mod download
    - run: golangci-lint run
    - run: go test -v ./...

workflows:
  version: 2
  main:
    jobs:
    - build:
        name: go1.12
        golang_version: "1.12"
        filters:
          tags:
            only: /.*/
    - build:
        name: go1.13
        golang_version: "1.13"
        filters:
          tags:
            only: /.*/
